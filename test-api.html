<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIæµ‹è¯•å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            color: #333;
            margin-bottom: 20px;
        }

        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }

        .test-section h2 {
            color: #666;
            font-size: 1.2rem;
            margin-bottom: 15px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }

        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        select {
            background: white;
            cursor: pointer;
        }

        textarea {
            min-height: 100px;
            font-family: monospace;
        }

        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
        }

        button:hover {
            background: #45a049;
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 13px;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .result.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .result.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .result.info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }

        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
        }

        .status.pending {
            background: #fff3cd;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ ç¡…åŸºæµåŠ¨APIæµ‹è¯•å·¥å…·</h1>

        <div class="test-section">
            <h2>1. APIé…ç½®</h2>
            <div class="input-group">
                <label for="apiKey">APIå¯†é’¥:</label>
                <input type="text" id="apiKey" value="sk-jtjlznpthxyxvsgmzmvvjzbdvlatwbhswfymntcbyiijmonw" placeholder="è¾“å…¥ä½ çš„APIå¯†é’¥">
            </div>
            <div class="input-group">
                <label for="modelSelect">é€‰æ‹©æ¨¡å‹:</label>
                <select id="modelSelect">
                    <option value="deepseek-ai/DeepSeek-V3">DeepSeek-V3 (æ¨è)</option>
                    <option value="deepseek-ai/DeepSeek-R1">DeepSeek-R1 (æ¨ç†)</option>
                    <option value="deepseek-ai/DeepSeek-V2.5">DeepSeek-V2.5</option>
                    <option value="Qwen/Qwen2.5-7B-Instruct">Qwen2.5-7B</option>
                    <option value="Qwen/Qwen2.5-72B-Instruct">Qwen2.5-72B</option>
                    <option value="meta-llama/Llama-3.1-8B-Instruct">Llama-3.1-8B</option>
                    <option value="meta-llama/Llama-3.1-70B-Instruct">Llama-3.1-70B</option>
                </select>
            </div>
            <button onclick="testApiKey()">æµ‹è¯•APIå¯†é’¥</button>
            <span id="apiKeyStatus" class="status"></span>
            <div id="apiKeyResult" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h2>2. ç½‘ç»œè¿æ¥æµ‹è¯•</h2>
            <button onclick="testNetwork()">æµ‹è¯•ç½‘ç»œè¿æ¥</button>
            <span id="networkStatus" class="status"></span>
            <div id="networkResult" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h2>3. APIè°ƒç”¨æµ‹è¯•</h2>
            <div class="input-group">
                <label for="testMessage">æµ‹è¯•æ¶ˆæ¯:</label>
                <input type="text" id="testMessage" value="ä½ å¥½,è¯·ä»‹ç»ä¸€ä¸‹è‡ªå·±" placeholder="è¾“å…¥æµ‹è¯•æ¶ˆæ¯">
            </div>
            <button onclick="testApiCall()">æµ‹è¯•APIè°ƒç”¨</button>
            <span id="apiCallStatus" class="status"></span>
            <div id="apiCallResult" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h2>4. å®Œæ•´è¯Šæ–­</h2>
            <button onclick="runFullDiagnosis()">è¿è¡Œå®Œæ•´è¯Šæ–­</button>
            <span id="diagnosisStatus" class="status"></span>
            <div id="diagnosisResult" class="result" style="display: none;"></div>
        </div>
    </div>

    <script>
        const API_URL = 'https://api.siliconflow.cn/v1/chat/completions';

        function showResult(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `result ${type}`;
            element.style.display = 'block';
        }

        function showStatus(elementId, text, type) {
            const element = document.getElementById(elementId);
            element.textContent = text;
            element.className = `status ${type}`;
        }

        async function testApiKey() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const model = document.getElementById('modelSelect').value;
            
            if (!apiKey) {
                showResult('apiKeyResult', 'è¯·è¾“å…¥APIå¯†é’¥', 'error');
                showStatus('apiKeyStatus', 'å¤±è´¥', 'error');
                return;
            }

            showStatus('apiKeyStatus', 'æµ‹è¯•ä¸­...', 'pending');
            showResult('apiKeyResult', 'æ­£åœ¨æµ‹è¯•APIå¯†é’¥å’Œæ¨¡å‹...', 'info');

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        messages: [{ role: 'user', content: 'test' }],
                        model: model,
                        stream: false
                    })
                });

                if (response.ok) {
                    showResult('apiKeyResult', 'âœ… APIå¯†é’¥å’Œæ¨¡å‹éƒ½æœ‰æ•ˆ!\nçŠ¶æ€ç : ' + response.status + '\nä½¿ç”¨æ¨¡å‹: ' + model, 'success');
                    showStatus('apiKeyStatus', 'æˆåŠŸ', 'success');
                } else {
                    const errorText = await response.text();
                    showResult('apiKeyResult', 'âŒ APIå¯†é’¥æˆ–æ¨¡å‹æ— æ•ˆ\nçŠ¶æ€ç : ' + response.status + '\né”™è¯¯ä¿¡æ¯: ' + errorText, 'error');
                    showStatus('apiKeyStatus', 'å¤±è´¥', 'error');
                }
            } catch (error) {
                showResult('apiKeyResult', 'âŒ ç½‘ç»œé”™è¯¯: ' + error.message, 'error');
                showStatus('apiKeyStatus', 'å¤±è´¥', 'error');
            }
        }

        async function testNetwork() {
            showStatus('networkStatus', 'æµ‹è¯•ä¸­...', 'pending');
            showResult('networkResult', 'æ­£åœ¨æµ‹è¯•ç½‘ç»œè¿æ¥...', 'info');

            try {
                const response = await fetch('https://api.siliconflow.cn/v1/models', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${document.getElementById('apiKey').value.trim()}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    showResult('networkResult', 'âœ… ç½‘ç»œè¿æ¥æ­£å¸¸!\nå¯ç”¨æ¨¡å‹: ' + JSON.stringify(data, null, 2), 'success');
                    showStatus('networkStatus', 'æˆåŠŸ', 'success');
                } else {
                    showResult('networkResult', 'âŒ ç½‘ç»œè¿æ¥å¤±è´¥\nçŠ¶æ€ç : ' + response.status, 'error');
                    showStatus('networkStatus', 'å¤±è´¥', 'error');
                }
            } catch (error) {
                showResult('networkResult', 'âŒ ç½‘ç»œé”™è¯¯: ' + error.message + '\n\nå¯èƒ½çš„åŸå› :\n1. ç½‘ç»œè¿æ¥é—®é¢˜\n2. é˜²ç«å¢™é˜»æ­¢\n3. DNSè§£æé—®é¢˜', 'error');
                showStatus('networkStatus', 'å¤±è´¥', 'error');
            }
        }

        async function testApiCall() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const message = document.getElementById('testMessage').value.trim();
            const model = document.getElementById('modelSelect').value;

            if (!apiKey) {
                showResult('apiCallResult', 'è¯·è¾“å…¥APIå¯†é’¥', 'error');
                showStatus('apiCallStatus', 'å¤±è´¥', 'error');
                return;
            }

            if (!message) {
                showResult('apiCallResult', 'è¯·è¾“å…¥æµ‹è¯•æ¶ˆæ¯', 'error');
                showStatus('apiCallStatus', 'å¤±è´¥', 'error');
                return;
            }

            showStatus('apiCallStatus', 'æµ‹è¯•ä¸­...', 'pending');
            showResult('apiCallResult', 'æ­£åœ¨å‘é€æµ‹è¯•è¯·æ±‚...', 'info');

            const startTime = Date.now();

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        messages: [{ role: 'user', content: message }],
                        model: model,
                        stream: false
                    })
                });

                const endTime = Date.now();
                const duration = endTime - startTime;

                if (response.ok) {
                    const data = await response.json();
                    const reply = data.choices[0].message.content;
                    
                    showResult('apiCallResult', 
                        'âœ… APIè°ƒç”¨æˆåŠŸ!\n\n' +
                        'å“åº”æ—¶é—´: ' + duration + 'ms\n' +
                        'ä½¿ç”¨æ¨¡å‹: ' + data.model + '\n' +
                        'ä½¿ç”¨Token: ' + (data.usage?.total_tokens || 'N/A') + '\n\n' +
                        'AIå›å¤:\n' + reply, 
                        'success'
                    );
                    showStatus('apiCallStatus', 'æˆåŠŸ', 'success');
                } else {
                    const errorText = await response.text();
                    showResult('apiCallResult', 
                        'âŒ APIè°ƒç”¨å¤±è´¥\n\n' +
                        'çŠ¶æ€ç : ' + response.status + '\n' +
                        'é”™è¯¯ä¿¡æ¯: ' + errorText, 
                        'error'
                    );
                    showStatus('apiCallStatus', 'å¤±è´¥', 'error');
                }
            } catch (error) {
                showResult('apiCallResult', 'âŒ è¯·æ±‚å¤±è´¥: ' + error.message, 'error');
                showStatus('apiCallStatus', 'å¤±è´¥', 'error');
            }
        }

        async function runFullDiagnosis() {
            showStatus('diagnosisStatus', 'è¯Šæ–­ä¸­...', 'pending');
            showResult('diagnosisResult', 'æ­£åœ¨è¿è¡Œå®Œæ•´è¯Šæ–­...\n\n', 'info');

            const results = [];
            const apiKey = document.getElementById('apiKey').value.trim();
            const model = document.getElementById('modelSelect').value;

            results.push('=== ç¡…åŸºæµåŠ¨APIå®Œæ•´è¯Šæ–­æŠ¥å‘Š ===\n');
            results.push(`è¯Šæ–­æ—¶é—´: ${new Date().toLocaleString('zh-CN')}\n`);
            results.push(`APIå¯†é’¥: ${apiKey.substring(0, 10)}...\n`);
            results.push(`é€‰æ‹©æ¨¡å‹: ${model}\n\n`);

            // 1. æ£€æŸ¥APIå¯†é’¥æ ¼å¼
            results.push('1. APIå¯†é’¥æ ¼å¼æ£€æŸ¥:');
            if (apiKey.startsWith('sk-') && apiKey.length > 20) {
                results.push('   âœ… APIå¯†é’¥æ ¼å¼æ­£ç¡®\n');
            } else {
                results.push('   âŒ APIå¯†é’¥æ ¼å¼ä¸æ­£ç¡®\n');
            }

            // 2. ç½‘ç»œè¿æ¥æµ‹è¯•
            results.push('\n2. ç½‘ç»œè¿æ¥æµ‹è¯•:');
            try {
                const response = await fetch('https://api.siliconflow.cn/v1/models', {
                    method: 'GET',
                    headers: { 'Authorization': `Bearer ${apiKey}` }
                });
                if (response.ok) {
                    results.push('   âœ… ç½‘ç»œè¿æ¥æ­£å¸¸\n');
                } else {
                    results.push(`   âŒ ç½‘ç»œè¿æ¥å¤±è´¥ (${response.status})\n`);
                }
            } catch (error) {
                results.push(`   âŒ ç½‘ç»œé”™è¯¯: ${error.message}\n`);
            }

            // 3. APIè°ƒç”¨æµ‹è¯•
            results.push('\n3. APIè°ƒç”¨æµ‹è¯•:');
            try {
                const startTime = Date.now();
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        messages: [{ role: 'user', content: 'ä½ å¥½' }],
                        model: model,
                        stream: false
                    })
                });
                const duration = Date.now() - startTime;

                if (response.ok) {
                    const data = await response.json();
                    results.push(`   âœ… APIè°ƒç”¨æˆåŠŸ (${duration}ms)\n`);
                    results.push(`   æ¨¡å‹: ${data.model}\n`);
                    results.push(`   Tokenä½¿ç”¨: ${data.usage?.total_tokens || 'N/A'}\n`);
                } else {
                    const errorText = await response.text();
                    results.push(`   âŒ APIè°ƒç”¨å¤±è´¥ (${response.status})\n`);
                    results.push(`   é”™è¯¯: ${errorText}\n`);
                }
            } catch (error) {
                results.push(`   âŒ è¯·æ±‚å¤±è´¥: ${error.message}\n`);
            }

            // 4. æµè§ˆå™¨ä¿¡æ¯
            results.push('\n4. æµè§ˆå™¨ä¿¡æ¯:');
            results.push(`   User Agent: ${navigator.userAgent}\n`);
            results.push(`   è¯­è¨€: ${navigator.language}\n`);

            // 5. å»ºè®®
            results.push('\n5. å»ºè®®:');
            if (results.join('').includes('âŒ')) {
                results.push('   âš ï¸ æ£€æµ‹åˆ°é—®é¢˜,è¯·æŸ¥çœ‹ä¸Šé¢çš„é”™è¯¯ä¿¡æ¯\n');
                results.push('   å¸¸è§è§£å†³æ–¹æ¡ˆ:\n');
                results.push('   - æ£€æŸ¥APIå¯†é’¥æ˜¯å¦æ­£ç¡®\n');
                results.push('   - æ£€æŸ¥æ¨¡å‹åç§°æ˜¯å¦æ­£ç¡®\n');
                results.push('   - æ£€æŸ¥ç½‘ç»œè¿æ¥\n');
                results.push('   - æ£€æŸ¥é˜²ç«å¢™è®¾ç½®\n');
                results.push('   - å°è¯•ä½¿ç”¨å…¶ä»–æµè§ˆå™¨\n');
            } else {
                results.push('   âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡,ç³»ç»Ÿæ­£å¸¸!\n');
            }

            showResult('diagnosisResult', results.join(''), 'info');
            showStatus('diagnosisStatus', 'å®Œæˆ', 'success');
        }
    </script>
</body>
</html>
